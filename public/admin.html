<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Secure Exam – Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  <link rel="stylesheet" href="/style.css" />

<style>
/* -------- Modal -------- */
.modal{
  position: fixed; inset:0; background:rgba(0,0,0,.6);
  display:flex; justify-content:center; align-items:center;
  z-index:9999;
}
.hidden{display:none;}
.modal-content{
  background:#fff; padding:20px; width:80%; max-height:90vh;
  overflow-y:auto; border-radius:8px; animation:fade .3s;
}
.close{float:right; font-size:22px; cursor:pointer;}
@keyframes fade{from{opacity:0}to{opacity:1}}
.correct{color:green;font-weight:bold;}
.wrong{color:red;font-weight:bold;}

.table-mini{width:100%;border-collapse:collapse;margin-top:10px}
.table-mini th,.table-mini td{border:1px solid #ddd;padding:6px;font-size:14px}
</style>

</head>

<body data-page="admin">
<div class="container">
    <h1>Admin Panel</h1>

    <!-- ---------- Admin Login ---------- -->
    <section id="adminLoginSection">
      <h3>Admin Login</h3>
      <div class="field">
        <label for="adminPassword">Password</label>
        <input type="password" id="adminPassword" />
      </div>
      <button id="adminLoginBtn" class="primary-btn">Login</button>
    </section>

    <!-- ---------- Admin Panel ---------- -->
    <section id="adminPanelSection" class="hidden">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h2>Dashboard</h2>
        <button id="adminLogoutBtn" class="secondary-btn">Logout</button>
      </div>

      <!-- Jump Buttons -->
      <div style="margin:15px 0;display:flex;gap:10px;">
        <button onclick="document.getElementById('questionForm').scrollIntoView()" class="primary-btn">Add Question</button>
        <button onclick="document.getElementById('questionsTable').scrollIntoView()" class="primary-btn">Questions</button>
        <button onclick="document.getElementById('resultsTable').scrollIntoView()" class="primary-btn">Results</button>
      </div>

      <!-- Add / Edit Question -->
      <form id="questionForm">
        <input type="hidden" id="questionIndex"/>
        <input type="hidden" id="questionId"/>

        <label>Question</label>
        <textarea id="questionInput" required></textarea>

        <div class="field">
          <input type="text" id="optA" placeholder="Option A" required />
          <input type="text" id="optB" placeholder="Option B" required />
          <input type="text" id="optC" placeholder="Option C" required />
          <input type="text" id="optD" placeholder="Option D" required />
        </div>

        <label>Correct (A/B/C/D)</label>
        <input type="text" id="correctOption" maxlength="1" required/>

        <button type="submit" class="primary-btn">Save</button>
        <button type="button" id="resetFormBtn" class="secondary-btn">Clear</button>
      </form>

      <hr>

      <h2>Questions</h2>
      <table id="questionsTable">
        <thead><tr><th>#</th><th>Question</th><th>Correct</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>

      <hr>

      <h2>Results</h2>
      <table id="resultsTable">
        <thead>
          <tr>
            <th>#</th><th>Name</th><th>Email</th>
            <th>Score</th><th>Percentage</th><th>Warnings</th>
            <th>Submitted</th><th>Details</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
</div>


<!-- ===================== MODAL ===================== -->
<div id="resultModal" class="modal hidden">
  <div class="modal-content">
    <span id="closeModal" class="close">&times;</span>
    <h2>User Exam Details</h2>
    <div id="modalBody"></div>
  </div>
</div>


<script src="/main.js"></script>
<script>
// ========== Show modal details function injected ==========
function showResultDetails(result){
  const modal=document.getElementById("resultModal");
  const body=document.getElementById("modalBody");
  modal.classList.remove("hidden");

  body.innerHTML=`
  <p><b>Name:</b> ${result.userName}</p>
  <p><b>Email:</b> ${result.email}</p>
  <p><b>Score:</b> ${result.correct}/${result.total} (${result.percentage}%)</p>
  <p><b>Warnings:</b> ${result.warnings?.length||0}</p>
  <p><b>Submitted:</b> ${new Date(result.submittedAt).toLocaleString()}</p>
  <hr>

  <h3>Warnings Log</h3>
  ${result.warnings?.length?result.warnings.map(w=>`
    <p>#${w.count} — ${w.msg}<br><small>${w.at}</small></p>
  `).join(""):"<p>No Warnings</p>"}

  <hr><h3>Answers Overview</h3>
  <table class="table-mini">
    <tr><th>#</th><th>Question</th><th>Your</th><th>Correct</th><th>Status</th></tr>
    ${result.answers.map((a,i)=>`
      <tr>
        <td>${i+1}</td>
        <td>${a.question}</td>
        <td>${a.selectedOption||"-"}</td>
        <td>${a.correctOption}</td>
        <td class="${a.isCorrect?'correct':'wrong'}">${a.isCorrect?'✔ Correct':'✘ Wrong'}</td>
      </tr>
    `).join("")}
  </table>

  <hr>
  <h3>Full Question Breakdown</h3>
  ${result.answers.map((a,i)=>`
    <div>
      <b>${i+1}. ${a.question}</b>
      <ul>
        <li>A: ${a.options[0]}</li>
        <li>B: ${a.options[1]}</li>
        <li>C: ${a.options[2]}</li>
        <li>D: ${a.options[3]}</li>
      </ul>
      Your Answer: <b>${a.selectedOption||"-"}</b><br>
      Correct Answer: <b>${a.correctOption}</b><br>
      Status: ${a.isCorrect?'<span class="correct">Correct</span>':'<span class="wrong">Wrong</span>'}
      <hr>
    </div>
  `).join("")}
  `;

  document.getElementById("closeModal").onclick=()=>modal.classList.add("hidden");
  window.onclick=(e)=>{if(e.target===modal)modal.classList.add("hidden")}
}
</script>
</body>
</html>
